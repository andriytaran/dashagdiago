<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <!-- <base href="/"> -->

  <title>AgDiago</title>
  <meta name="description" content="">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- Template Basic Images Start -->
  <meta property="og:image" content="path/to/image.jpg">
  <link rel="icon" href="img/favicon/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="img/favicon/apple-touch-icon-180x180.png">
  <!-- Template Basic Images End -->

  <!-- Custom Browsers Color Start -->
  <meta name="theme-color" content="#F4F7FC">
  <!-- Custom Browsers Color End -->
  <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700" rel="stylesheet">
  <link rel="stylesheet" href="../updatedDesign/assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="../updatedDesign/css/main.min.css">

  <script src="../updatedDesign/assets/js/jquery-3.4.0.min.js"></script>
  <script src="../updatedDesign/assets/js/bootstrap.bundle.min.js"></script>
  <script src="../updatedDesign/assets/js/bootstrap.min.js"></script>
</head>

<body>

<%- partial('./partials/sidebarPositions') %>

<div class="wrap" id="mainSection">

  <%- partial('./partials/header') %>

  <section class="top-de-dashboard">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <h1 id="dashboard-position-page-header" class="top-de-dashboard__heading main-heading"></h1>
        </div>
        <div class="col-md-12">
          <div class="top-de-dashboard__table-block">
            <div id="dashboard-position-table-header" class="top-de-dashboard__table-b-desc secondary-heading">

            </div>
            <div class="top-de-dashboard__table players-table">
              <div class="players-table__header">
                <div class="row align-items-center">
                  <div class="col-md-1 offset-1">
                    <div class="players-table__heading">
                      Rate
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div class="players-table__heading">
                      First Name
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div class="players-table__heading">
                      Last Name
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div class="players-table__heading">
                      Position
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div class="players-table__heading">
                      Score
                    </div>
                  </div>
                </div>
              </div>
              <div id="dashboard-position-top-10-players" class="players-table__body">
              </div>
              <div class="players-table__note note">
                Note this data represent public DE players from schools accross the USA based on
                your registered Atheletic and Academic benchmarks
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-12">
          <div class="top-de-dashboard__core-attr core-attr">
            <div class="core-attr__subheading">
              Overal Scores
            </div>
            <div class="core-attr__block">
              <div class="core-attr__heading">
                Core Attributes
              </div>
              <div class="core-attr__ag-score">
                <div class="core-attr__ag-score-progressbar orange" style="width: 80%"></div>
                <div id="dashboard-position-core-attr-score" class="core-attr__ag-score-value"></div>
              </div>
              <button class="core-attr__more-btn" type="button" data-toggle="collapse"
                      data-target="#coreAttrMoreBlock" aria-expanded="false"
                      aria-controls="coreAttrMoreBlock">
                <span class="core-attr__more-btn-show">Show Sub Categories</span>
                <span class="core-attr__more-btn-hide">Hide Sub Categories</span>
                <div class="core-attr__more-btn-arrow">
                  <img src="../updatedDesign/img/core-attr-arrow.svg" alt="">
                </div>
              </button>
              <div class="core-attr__more-block collapse" id="coreAttrMoreBlock"
                   aria-labelledby="coreAttrMoreBlock">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<script src="../updatedDesign/constants.js"></script>
<script src="../updatedDesign/js/common.js"></script>
<script src="/../assets/js/app/api.js"></script>
<script src="../assets/plugins/jquery/jquery-3.3.1.min.js"></script>
<script src="../assets/plugins/jquery-ui/jquery-ui.min.js"></script>

<script>
  $(document).ready(function () {

    const urlParams = new URLSearchParams(window.location.search);

    let position = (urlParams.get("position") || "").toUpperCase();
    let highschoolGraduationYear = (urlParams.get("highschoolGraduationYear") || "").toUpperCase() || undefined;

    let header;

    if (highschoolGraduationYear){
      header = `<span>${position} </span> Position Dashboard for ${highschoolGraduationYear} class`
    } else {
      header = `<span>${position} </span> Position Dashboard for all classes`
    }

    $("#dashboard-position-page-header").html(header);
    $("#dashboard-position-table-header").html(`Top 10 ${position} Players`);

    getCulturalFitData(position, (res, status) => {
      if (status === 'success') {
      }
    })

    getCoreAttributesData(position, (res, status) => {
      if (status === 'success') {
        const { player } = res.attributes || {};
        const keys = Object.keys(player);

        const html = keys.map(key => {
          return `<div class="core-attr__heading">
                  ${attributesNamesMatches[key] || key}
                </div>
                <div class="core-attr__ag-score">
                  <div class="core-attr__ag-score-progressbar blue" style="width: ${player[key]}%">
                  </div>
                  <div class="core-attr__ag-score-value">${Math.round(player[key])} %</div>
                </div>`
        }).join('');

        $("#coreAttrMoreBlock").html(html);
      }
    })

    getTopCulturalFitData(position, highschoolGraduationYear, (res, status) => {
      if (status === 'success') {

        const { players = [] } = res;

        const html = players.map((player, index) => {

          const { fname, id, lname, position, team, value } = player;

          return `<div class="players-table__row">
                  <div class="row align-items-center">
                    <div class="col-md-1">
                      <div class="players-table__item avatar">
                        <img src="../updatedDesign/img/player-avatar.jpg" alt="">
                      </div>
                    </div>
                    <div class="col-md-1">
                      <div class="players-table__item">
                        ${index + 1}
                      </div>
                    </div>
                    <div class="col-md-2">
                      <div class="players-table__item">
                        ${fname}
                      </div>
                    </div>
                    <div class="col-md-2">
                      <div class="players-table__item">
                         ${lname}
                      </div>
                    </div>
                    <div class="col-md-2">
                      <div class="players-table__item">
                        ${position}
                      </div>
                    </div>
                    <div class="col-md-1">
                      <div class="players-table__item">
                        ${Math.round(value)}
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="players-table__item btn-block">
                        <a href="/dashboard-player/?id=${id}"><button class="showdetails-btn">Show Details</button></a>
                      </div>
                    </div>
                  </div>
                </div>`
        }).join("");

        $("#dashboard-position-top-10-players").html(html);

      }
    })

    getOverallScoresData(position, (res, status) => {
      if (status === 'success') {
        const coreAttributesScore = Math.round(res.scores.player.coreAttributes);

        $("#dashboard-position-core-attr-score").html(`AG Score: ${coreAttributesScore}`);
      }
    })

  });

</script>

</body>

</html>
