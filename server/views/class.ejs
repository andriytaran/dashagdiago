<%-partial('./partials/basePageHeader')%>

<body>

<%-partial('./partials/sidebarPositions')%>

<div class="wrap" id="mainSection">

  <%-partial('./partials/header')%>

  <section class="s-player-dashboard">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <h1 id="dashboard-switch-class"  class="s-player-dashboard__heading main-heading"></h1>
          <h1 id="dashboard-name" class="s-player-dashboard__heading main-heading"></h1>
        </div>
        <div class="col-md-12">
          <h4 class="s-player-dashboard__full-view">Full view of players</h4>
          <div class="s-player-dashboard__class-block class-block">
            <div class="row">
              <div class="col-md-4">
                <a href="#" class="class-block__class blue">
                  <div class="class-block__class-heading">University of Cincinnati Potential
                    Recruits
                    matches based on coatch benchmarks
                  </div>
                  <div class="class-block__class-number"><%= overallCount %></div>
                </a>
              </div>
              <div class="col-md-4">
                <a href="#" class="class-block__class green">
                  <div class="class-block__class-heading">University of Cincinnati Potential</br>
                    Defensive Recruits
                  </div>
                  <div class="s-player-dashboard__class-number"><%= defenseCount %></div>
                </a>
              </div>
              <div class="col-md-4">
                <a href="#" class="class-block__class red">
                  <div class="class-block__class-heading">University of Cincinnati Potential</br>
                    Offensive Recruits
                  </div>
                  <div class="class-block__class-number"><%= offenseCount %></div>
                </a>
              </div>
            </div>
          </div>
          <div class="s-player-dashboard__table-block">
            <div class="s-player-dashboard__table-b-heading small-desc">
              Cultural Fit
            </div>
            <div class="s-player-dashboard__table-b-desc secondary-heading">
              Top potential recruits to review
            </div>
            <div class="s-player-dashboard__table players-table">
              <div class="players-table__header">
                <div class="row align-items-center">
                  <div class="col-md-1 offset-1">
                    <div class="players-table__heading">
                      Rate
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div class="players-table__heading">
                      First Name
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div class="players-table__heading">
                      Last Name
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div class="players-table__heading">
                      Position
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div class="players-table__heading">
                      Score
                    </div>
                  </div>
                </div>
              </div>
              <div id="CulturalFitTable" class="players-table__body"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<div class="modal fade" id="add-attr" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button id="close-modal" type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form class="s-benchmark-input__form add-attr-form form">
          <div class="add-attr-form__header">
            <div class="row align-items-center">
              <div class="col-md-12 ">
                <div class="add-attr-form__heading">
                  Deleting of player
                </div>
              </div>
            </div>
          </div>
          <div class="add-attr-form__body">
            <div class="add-attr-form__group form__group">
              <div class="row">
                <div class="col-md-12 d-flex align-items-center">
                  <label id="delete-user-info" class="add-attr-form__group-label form__group-label"></label>
                </div>
              </div>

              <div class="row">
                <div class="col-md-12 d-flex align-items-center">
                  <label for="40yd" class="add-attr-form__group-label form__group-label">Are you sure ? </label>
                </div>
              </div>

            </div>

            <div id="delete-button-modal" class="add-attr-form__submit-btn-block form__submit-btn-block">
              <input type="button" class="add-attr-form__form-submit-btn form__submit-btn" value="Yes">
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script src="/../assets/js/app/api.js"></script>
<script src="../updatedDesign/js/common.js"></script>
<script src="../updatedDesign/constants.js"></script>
<script src="../updatedDesign/modal.js"></script>

<script>
  $(document).ready(function () {

    updateHeaderLinks();

    const urlParams = new URLSearchParams(window.location.search);

    let allClasses = urlParams.get("allClasses");
    let highschoolGraduationYear = (urlParams.get("highschoolGraduationYear") || "").toUpperCase() || "ALL";

    let header;

    if (highschoolGraduationYear && highschoolGraduationYear !== "ALL" && !allClasses){
      header = `<span>${highschoolGraduationYear} class,</span> Dashboard`
    } else {
      header = `<span>All classes,</span> Dashboard`
    }

    $('#dashboard-name').html(header);

    const links = `<a href="/class?highschoolGraduationYear=${highschoolGraduationYear}&allClasses=${1}">All classes</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="/class?highschoolGraduationYear=${highschoolGraduationYear}">Current class</a> `

    $('#dashboard-switch-class').html(links);

    const updateDataTable = () => {
      getTopCulturalFitData(undefined, allClasses ? "ALL" : highschoolGraduationYear, (res, status) => {
        if (status === 'success') {

          const tableHtml = res.players.map((player, index) => {

            const {
              fname,
              id,
              lname,
              position,
              team,
              value,
            } = player

            return `<div class="players-table__row">
                  <div class="row align-items-center">
                    <div class="col-md-1">
                      <div class="players-table__item avatar">
                        <img src="../updatedDesign/img/player-avatar.jpg" alt="">
                      </div>
                    </div>
                    <div class="col-md-1">
                      <div class="players-table__item">
                        ${index + 1}
                      </div>
                    </div>
                    <div class="col-md-2">
                      <div class="players-table__item">
                        ${fname}
                      </div>
                    </div>
                    <div class="col-md-2">
                      <div class="players-table__item">
                        ${lname}
                      </div>
                    </div>
                    <div class="col-md-2">
                      <div class="players-table__item">
                        ${position}
                      </div>
                    </div>
                    <div class="col-md-1">
                      <div class="players-table__item">
                        ${Math.round(value)}
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="players-table__item btn-block">
                        <a href="/dashboard-player/?id=${id}&highschoolGraduationYear=${highschoolGraduationYear}">
                          <button class="showdetails-btn">Show Details</button>
                        </a>
                        <a href="/addnewathlete?id=${id}&highschoolGraduationYear=${highschoolGraduationYear}">
                          <button class="edit-btn"><img src="../updatedDesign/img/edit-icon.svg" alt=""></button>
                        </a>
                        <button id="delete-button-${id}" data-target="#add-attr" data-toggle="modal" data-player="${id}" data-name="${`${fname} ${lname}`}" class="delete-btn"><img src="../updatedDesign/img/delete-icon.svg" alt=""></button>
                      </div>
                    </div>
                  </div>
                </div>`
          }).join('');

          $('#CulturalFitTable').html(tableHtml);

          $(`.delete-btn`).click(function () {
            const pid = $(this).data('player')
            const name = $(this).data('name')

            $('#delete-user-info').html(`User ${name} will be deleted`);
            $('#delete-button-modal').off('click');

            $('#delete-button-modal').click(() => {
              deletePlayerById(pid, ()=>{
                $('#close-modal').click();
                setTimeout(updateDataTable, 1000);
              })
            });
          });
        }
      });
    }

    updateDataTable()

  });

</script>

</body>

</html>
